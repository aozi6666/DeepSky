# è™šæ‹Ÿåˆ—è¡¨æ ¸å¿ƒå®ç°åŸç†ï¼ˆå‰ç«¯å°ç™½ç‰ˆï¼‰

## ğŸ“– ç›®å½•

1. [ä¸ºä»€ä¹ˆéœ€è¦è™šæ‹Ÿåˆ—è¡¨ï¼Ÿ](#ä¸ºä»€ä¹ˆéœ€è¦è™šæ‹Ÿåˆ—è¡¨)
2. [æ ¸å¿ƒæ€æƒ³ï¼šåªæ¸²æŸ“çœ‹å¾—è§çš„](#æ ¸å¿ƒæ€æƒ³åªæ¸²æŸ“çœ‹å¾—è§çš„)
3. [å®ç°æ­¥éª¤æ‹†è§£](#å®ç°æ­¥éª¤æ‹†è§£)
4. [ä»£ç é€è¡Œè§£æ](#ä»£ç é€è¡Œè§£æ)
5. [å…³é”®æŠ€å·§æ€»ç»“](#å…³é”®æŠ€å·§æ€»ç»“)

---

## ä¸ºä»€ä¹ˆéœ€è¦è™šæ‹Ÿåˆ—è¡¨ï¼Ÿ

### é—®é¢˜åœºæ™¯

æƒ³è±¡ä¸€ä¸‹ï¼Œä½ è¦æ¸²æŸ“ **10000 æ¡æ•°æ®**ï¼š

```jsx
// âŒ ä¼ ç»Ÿåšæ³•ï¼šå…¨éƒ¨æ¸²æŸ“
{data.map(item => <div>{item.value}</div>)}
```

**é—®é¢˜**ï¼š
- æµè§ˆå™¨è¦åˆ›å»º **10000 ä¸ª DOM èŠ‚ç‚¹**
- å†…å­˜å ç”¨å·¨å¤§
- é¦–æ¬¡æ¸²æŸ“éå¸¸æ…¢
- æ»šåŠ¨å¡é¡¿

### è§£å†³æ–¹æ¡ˆ

**è™šæ‹Ÿåˆ—è¡¨çš„æ ¸å¿ƒæ€æƒ³**ï¼šç”¨æˆ·ä¸€æ¬¡åªèƒ½çœ‹åˆ°å±å¹•ä¸Šçš„å‡ æ¡æ•°æ®ï¼ˆæ¯”å¦‚ 10-20 æ¡ï¼‰ï¼Œé‚£å°±**åªæ¸²æŸ“è¿™ 10-20 æ¡**ï¼

- âœ… æ— è®ºæ•°æ®æœ‰å¤šå°‘æ¡ï¼Œ**åªæ¸²æŸ“å¯è§çš„ + å°‘é‡ç¼“å†²**
- âœ… å†…å­˜å ç”¨å›ºå®šï¼ˆæ¯”å¦‚åªåˆ›å»º 20 ä¸ª DOMï¼‰
- âœ… æ»šåŠ¨æµç•…

---

## æ ¸å¿ƒæ€æƒ³ï¼šåªæ¸²æŸ“çœ‹å¾—è§çš„

### è§†è§‰ä¸Šçš„â€œéšœçœ¼æ³•â€

è™šæ‹Ÿåˆ—è¡¨ç”¨äº†ä¸¤ä¸ªå…³é”®æŠ€å·§ï¼š

1. **å ä½å…ƒç´ **ï¼šç”¨ä¸€ä¸ªç©ºçš„ `div` æ’‘å‡ºæ€»é«˜åº¦ï¼Œè®©æ»šåŠ¨æ¡â€œçœ‹èµ·æ¥åƒå®Œæ•´åˆ—è¡¨â€
2. **ç»å¯¹å®šä½ + transform**ï¼šæŠŠçœŸæ­£è¦æ¸²æŸ“çš„å‡ æ¡æ•°æ®ï¼Œç”¨ CSS å®šä½åˆ°æ­£ç¡®çš„ä½ç½®

### ç¤ºæ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¯è§†åŒºåŸŸï¼ˆ500pxé«˜ï¼‰     â”‚ â† ç”¨æˆ·çœ‹åˆ°çš„çª—å£
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Item 0                 â”‚ â† å®é™…æ¸²æŸ“çš„ DOM
â”‚  Item 1                 â”‚
â”‚  Item 2                 â”‚
â”‚  ...                    â”‚
â”‚  Item 9                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [å ä½ç©ºç™½åŒºåŸŸ]          â”‚ â† ç©ºçš„ divï¼Œæ’‘é«˜åº¦
â”‚  [å ä½ç©ºç™½åŒºåŸŸ]          â”‚
â”‚  ...                    â”‚
â”‚  [å ä½ç©ºç™½åŒºåŸŸ]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®**ï¼šå ä½å…ƒç´ è®©æ»šåŠ¨æ¡æœ‰æ­£ç¡®çš„æ€»é«˜åº¦ï¼Œå®é™…æ¸²æŸ“çš„ DOM åªæœ‰ 10 æ¡ï¼Œä½†é€šè¿‡ `transform` å®šä½ï¼Œçœ‹èµ·æ¥å°±åƒåœ¨æ­£ç¡®çš„ä½ç½®ã€‚

---

## å®ç°æ­¥éª¤æ‹†è§£

### æ­¥éª¤ 1ï¼šè®¡ç®—æ€»é«˜åº¦ï¼ˆå ä½ç”¨ï¼‰

```typescript
const containerHeight = listData.length * itemSize;
```

**ä½œç”¨**ï¼šå‘Šè¯‰æµè§ˆå™¨â€œè¿™ä¸ªåˆ—è¡¨æ€»å…±æœ‰å¤šé«˜â€ï¼Œè®©æ»šåŠ¨æ¡èƒ½æ­£ç¡®æ˜¾ç¤ºã€‚

**ä¾‹å­**ï¼š
- 10000 æ¡æ•°æ®ï¼Œæ¯æ¡ 50px
- `containerHeight = 10000 * 50 = 500000px`
- æ»šåŠ¨æ¡å°±çŸ¥é“æ€»é«˜åº¦æ˜¯ 500000px

### æ­¥éª¤ 2ï¼šè®¡ç®—å¯è§†åŒºåŸŸèƒ½æ˜¾ç¤ºå¤šå°‘æ¡

```typescript
const visibleCount = Math.ceil(height / itemSize);
```

**ä½œç”¨**ï¼šç®—å‡ºåœ¨å½“å‰çª—å£é«˜åº¦ä¸‹ï¼Œæœ€å¤šèƒ½çœ‹åˆ°å‡ æ¡ã€‚

**ä¾‹å­**ï¼š
- å®¹å™¨é«˜åº¦ `height = 500px`
- æ¯æ¡é«˜åº¦ `itemSize = 50px`
- `visibleCount = Math.ceil(500 / 50) = 10`
- è¯´æ˜æœ€å¤šèƒ½çœ‹åˆ° 10 æ¡

### æ­¥éª¤ 3ï¼šæ ¹æ®æ»šåŠ¨ä½ç½®ï¼Œè®¡ç®—éœ€è¦æ¸²æŸ“çš„ç´¢å¼•èŒƒå›´

```typescript
const startIndex = Math.floor(scrollTop / itemSize);
const endIndex = startIndex + visibleCount;
```

**ä½œç”¨**ï¼šæ ¹æ®ç”¨æˆ·æ»šåŠ¨äº†å¤šå°‘ï¼ˆ`scrollTop`ï¼‰ï¼Œç®—å‡ºâ€œç°åœ¨åº”è¯¥æ˜¾ç¤ºç¬¬å‡ æ¡åˆ°ç¬¬å‡ æ¡â€ã€‚

**ä¾‹å­**ï¼š
- ç”¨æˆ·æ»šåŠ¨äº† `scrollTop = 250px`
- `startIndex = Math.floor(250 / 50) = 5`ï¼ˆä»ç¬¬ 5 æ¡å¼€å§‹ï¼‰
- `endIndex = 5 + 10 = 15`ï¼ˆåˆ°ç¬¬ 15 æ¡ç»“æŸï¼‰
- æ‰€ä»¥éœ€è¦æ¸²æŸ“ï¼š`data[5]` åˆ° `data[14]`ï¼ˆå…± 10 æ¡ï¼‰

### æ­¥éª¤ 4ï¼šæ·»åŠ  overscanï¼ˆç¼“å†²åŒºåŸŸï¼‰

```typescript
const safeStart = Math.max(0, startIndex - overscan);
const safeEnd = Math.min(listData.length, endIndex + overscan);
```

**ä½œç”¨**ï¼šä¸Šä¸‹å¤šæ¸²æŸ“å‡ æ¡ï¼Œé¿å…å¿«é€Ÿæ»šåŠ¨æ—¶å‡ºç°â€œç™½å±â€ã€‚

**ä¾‹å­**ï¼š
- `overscan = 3`
- `safeStart = 5 - 3 = 2`ï¼ˆå‘ä¸Šå¤šæ¸²æŸ“ 3 æ¡ï¼‰
- `safeEnd = 15 + 3 = 18`ï¼ˆå‘ä¸‹å¤šæ¸²æŸ“ 3 æ¡ï¼‰
- å®é™…æ¸²æŸ“ï¼š`data[2]` åˆ° `data[17]`ï¼ˆå…± 16 æ¡ï¼‰

**ä¸ºä»€ä¹ˆéœ€è¦**ï¼šå¦‚æœåªæ¸²æŸ“ `data[5]` åˆ° `data[14]`ï¼Œç”¨æˆ·å¿«é€Ÿæ»šåŠ¨æ—¶ï¼Œå¯èƒ½è¿˜æ²¡æ¸²æŸ“å®Œå°±æ»šè¿‡å»äº†ï¼Œä¼šçœ‹åˆ°ç©ºç™½ã€‚å¤šæ¸²æŸ“å‡ æ¡ï¼Œæ»šåŠ¨æ›´é¡ºæ»‘ã€‚

### æ­¥éª¤ 5ï¼šåˆ‡ç‰‡æ•°æ®ï¼Œåªæ¸²æŸ“éœ€è¦çš„éƒ¨åˆ†

```typescript
const renderedItems = useMemo(() => {
  return listData.slice(safeStart, safeEnd);
}, [listData, safeStart, safeEnd]);
```

**ä½œç”¨**ï¼šä»å®Œæ•´æ•°æ®é‡Œï¼Œåˆ‡å‡ºéœ€è¦æ¸²æŸ“çš„é‚£ä¸€å°æ®µã€‚

**ä¾‹å­**ï¼š
- `listData` æœ‰ 10000 æ¡
- `renderedItems` åªæœ‰ 16 æ¡ï¼ˆ`data[2]` åˆ° `data[17]`ï¼‰
- åªå¯¹è¿™ 16 æ¡åˆ›å»º DOM

### æ­¥éª¤ 6ï¼šè®¡ç®—åç§»é‡ï¼ˆå®šä½ï¼‰

```typescript
const offset = safeStart * itemSize;
```

**ä½œç”¨**ï¼šç®—å‡ºâ€œè¿™æ®µæ•°æ®åº”è¯¥å‡ºç°åœ¨å“ªä¸ªä½ç½®â€ã€‚

**ä¾‹å­**ï¼š
- `safeStart = 2`
- `offset = 2 * 50 = 100px`
- è¯´æ˜è¿™æ®µæ•°æ®åº”è¯¥ä»è·ç¦»é¡¶éƒ¨ 100px çš„ä½ç½®å¼€å§‹æ˜¾ç¤º

---

## ä»£ç é€è¡Œè§£æ

### å®Œæ•´ä»£ç ç»“æ„

```typescript
export function VirtualList<T extends VirtualListItem>({
  listData,      // å®Œæ•´æ•°æ®æ•°ç»„
  itemSize,      // æ¯æ¡å›ºå®šé«˜åº¦ï¼ˆpxï¼‰
  height,        // å®¹å™¨å¯è§†é«˜åº¦ï¼ˆpxï¼‰
  overscan = 2,  // ä¸Šä¸‹å¤šæ¸²æŸ“å‡ æ¡ï¼ˆé»˜è®¤ 2ï¼‰
  renderItem,    // è‡ªå®šä¹‰æ¸²æŸ“å‡½æ•°ï¼ˆå¯é€‰ï¼‰
}: VirtualListProps<T>) {
  // ... å®ç°ä»£ç 
}
```

### ç¬¬ä¸€éƒ¨åˆ†ï¼šçŠ¶æ€å’Œå¼•ç”¨

```typescript
const containerRef = useRef<HTMLDivElement | null>(null);
const [scrollTop, setScrollTop] = useState(0);
```

- `containerRef`ï¼šç”¨æ¥è·å–å®¹å™¨ DOM å…ƒç´ ï¼ˆè™½ç„¶è¿™é‡Œæ²¡ç”¨åˆ°ï¼Œä½†ä¿ç•™ç»™æœªæ¥æ‰©å±•ï¼‰
- `scrollTop`ï¼šè®°å½•ç”¨æˆ·æ»šåŠ¨äº†å¤šå°‘åƒç´ 

### ç¬¬äºŒéƒ¨åˆ†ï¼šæ ¸å¿ƒè®¡ç®—

```typescript
// 1. æ€»é«˜åº¦ï¼ˆå ä½ç”¨ï¼‰
const containerHeight = listData.length * itemSize;

// 2. å¯è§†åŒºåŸŸèƒ½æ˜¾ç¤ºå¤šå°‘æ¡
const visibleCount = Math.ceil(height / itemSize);

// 3. æ ¹æ®æ»šåŠ¨ä½ç½®ï¼Œè®¡ç®—ç´¢å¼•èŒƒå›´
const startIndex = Math.floor(scrollTop / itemSize);
const endIndex = startIndex + visibleCount;

// 4. åŠ  overscan ç¼“å†²
const safeStart = Math.max(0, startIndex - overscan);
const safeEnd = Math.min(listData.length, endIndex + overscan);

// 5. åˆ‡ç‰‡æ•°æ®
const renderedItems = useMemo(() => {
  return listData.slice(safeStart, safeEnd);
}, [listData, safeStart, safeEnd]);

// 6. è®¡ç®—åç§»é‡
const offset = safeStart * itemSize;
```

**é€è¡Œè§£é‡Š**ï¼š

1. **`containerHeight`**ï¼šæ€»é«˜åº¦ = æ•°æ®æ¡æ•° Ã— æ¯æ¡é«˜åº¦
2. **`visibleCount`**ï¼šå‘ä¸Šå–æ•´ï¼Œç¡®ä¿èƒ½å®Œå…¨æ˜¾ç¤º
3. **`startIndex`**ï¼š`scrollTop / itemSize` å‘ä¸‹å–æ•´ï¼Œå¾—åˆ°èµ·å§‹ç´¢å¼•
4. **`endIndex`**ï¼šèµ·å§‹ç´¢å¼• + å¯è§æ•°é‡
5. **`safeStart`**ï¼š`Math.max(0, ...)` é˜²æ­¢è´Ÿæ•°ï¼Œå‡å» `overscan` å‘ä¸Šå¤šæ¸²æŸ“
6. **`safeEnd`**ï¼š`Math.min(...)` é˜²æ­¢è¶…å‡ºæ•°ç»„é•¿åº¦ï¼ŒåŠ ä¸Š `overscan` å‘ä¸‹å¤šæ¸²æŸ“
7. **`renderedItems`**ï¼šç”¨ `useMemo` ç¼“å­˜ï¼Œåªæœ‰ä¾èµ–å˜åŒ–æ—¶æ‰é‡æ–°è®¡ç®—
8. **`offset`**ï¼šåç§»é‡ = èµ·å§‹ç´¢å¼• Ã— æ¯æ¡é«˜åº¦

### ç¬¬ä¸‰éƒ¨åˆ†ï¼šæ»šåŠ¨äº‹ä»¶å¤„ç†

```typescript
const onScroll = (e: React.UIEvent<HTMLDivElement>) => {
  setScrollTop(e.currentTarget.scrollTop);
};
```

**ä½œç”¨**ï¼šç”¨æˆ·æ»šåŠ¨æ—¶ï¼Œæ›´æ–° `scrollTop` çŠ¶æ€ï¼Œè§¦å‘é‡æ–°è®¡ç®—å’Œæ¸²æŸ“ã€‚

**æµç¨‹**ï¼š
1. ç”¨æˆ·æ»šåŠ¨ â†’ `onScroll` è§¦å‘
2. æ›´æ–° `scrollTop` â†’ React é‡æ–°æ¸²æŸ“
3. é‡æ–°è®¡ç®— `startIndex`ã€`endIndex`ã€`renderedItems`
4. é‡æ–°æ¸²æŸ“æ–°çš„æ•°æ®åˆ‡ç‰‡

### ç¬¬å››éƒ¨åˆ†ï¼šJSX ç»“æ„ï¼ˆå…³é”®ï¼ï¼‰

```typescript
return (
  <div
    ref={containerRef}
    onScroll={onScroll}
    style={{
      position: "relative",  // ç›¸å¯¹å®šä½ï¼Œä½œä¸ºå®šä½å‚è€ƒ
      overflow: "auto",      // å…è®¸æ»šåŠ¨
      height,                // å›ºå®šé«˜åº¦
      border: "1px solid #ddd",
    }}
  >
    {/* å ä½å…ƒç´ ï¼šæ’‘å‡ºæ€»é«˜åº¦ */}
    <div style={{ height: containerHeight }} />

    {/* æ¸²æŸ“å±‚ï¼šç»å¯¹å®šä½ + transform */}
    <div
      style={{
        position: "absolute",  // ç»å¯¹å®šä½
        left: 0,
        right: 0,
        top: 0,
        transform: `translate3d(0, ${offset}px, 0)`,  // å…³é”®ï¼šå‘ä¸‹åç§»
        willChange: "transform",  // æ€§èƒ½ä¼˜åŒ–æç¤º
      }}
    >
      {renderedItems.map((item, i) => {
        const realIndex = safeStart + i;
        return (
          <div
            key={item.uid}
            style={{
              height: itemSize,
              boxSizing: "border-box",
              borderBottom: "1px solid #eee",
              display: "flex",
              alignItems: "center",
              padding: "0 12px",
              background: "white",
            }}
          >
            {renderItem ? renderItem(item, realIndex) : item.value}
          </div>
        );
      })}
    </div>
  </div>
);
```

**ç»“æ„è§£æ**ï¼š

1. **å¤–å±‚å®¹å™¨** (`position: relative`)
   - è®¾ç½®å›ºå®šé«˜åº¦å’Œæ»šåŠ¨
   - ä½œä¸ºå†…éƒ¨ç»å¯¹å®šä½çš„å‚è€ƒ

2. **å ä½å…ƒç´ ** (`height: containerHeight`)
   - ç©ºçš„ `div`ï¼Œåªç”¨æ¥æ’‘é«˜åº¦
   - è®©æ»šåŠ¨æ¡æœ‰æ­£ç¡®çš„æ€»é«˜åº¦

3. **æ¸²æŸ“å±‚** (`position: absolute` + `transform`)
   - **ç»å¯¹å®šä½**ï¼šè„±ç¦»æ–‡æ¡£æµï¼Œä¸å ç©ºé—´
   - **`transform: translate3d(0, ${offset}px, 0)`**ï¼šå‘ä¸‹ç§»åŠ¨ `offset` åƒç´ 
   - **`willChange: "transform"`**ï¼šå‘Šè¯‰æµè§ˆå™¨è¿™ä¸ªå…ƒç´ ä¼šé¢‘ç¹å˜æ¢ï¼Œæå‰ä¼˜åŒ–

4. **å®é™…æ¸²æŸ“çš„åˆ—è¡¨é¡¹**
   - åªæ¸²æŸ“ `renderedItems`ï¼ˆæ¯”å¦‚ 16 æ¡ï¼‰
   - æ¯æ¡é«˜åº¦å›ºå®š `itemSize`
   - é€šè¿‡ `transform` å®šä½åˆ°æ­£ç¡®ä½ç½®

### å…³é”®æŠ€å·§ï¼šä¸ºä»€ä¹ˆç”¨ `transform` è€Œä¸æ˜¯ `top`ï¼Ÿ

```typescript
// âŒ ä¸æ¨è
style={{ top: `${offset}px` }}

// âœ… æ¨è
style={{ transform: `translate3d(0, ${offset}px, 0)` }}
```

**åŸå› **ï¼š
- `transform` ä¸ä¼šè§¦å‘**é‡æ’ï¼ˆreflowï¼‰**ï¼Œåªè§¦å‘**é‡ç»˜ï¼ˆrepaintï¼‰**
- `transform` å¯ä»¥ç”¨ GPU åŠ é€Ÿï¼Œæ€§èƒ½æ›´å¥½
- æ»šåŠ¨æ—¶é¢‘ç¹æ›´æ–°ä½ç½®ï¼Œç”¨ `transform` æ›´æµç•…

---

## å…³é”®æŠ€å·§æ€»ç»“

### 1. ä¸‰å±‚ç»“æ„

```
å®¹å™¨ï¼ˆrelativeï¼Œå›ºå®šé«˜åº¦ï¼Œå¯æ»šåŠ¨ï¼‰
  â”œâ”€ å ä½å…ƒç´ ï¼ˆæ’‘æ€»é«˜åº¦ï¼‰
  â””â”€ æ¸²æŸ“å±‚ï¼ˆabsoluteï¼Œtransform å®šä½ï¼‰
      â””â”€ å®é™…åˆ—è¡¨é¡¹ï¼ˆåªæ¸²æŸ“å¯è§çš„ï¼‰
```

### 2. æ ¸å¿ƒå…¬å¼

- **æ€»é«˜åº¦** = `æ•°æ®æ¡æ•° Ã— æ¯æ¡é«˜åº¦`
- **å¯è§æ•°é‡** = `å®¹å™¨é«˜åº¦ Ã· æ¯æ¡é«˜åº¦`ï¼ˆå‘ä¸Šå–æ•´ï¼‰
- **èµ·å§‹ç´¢å¼•** = `æ»šåŠ¨è·ç¦» Ã· æ¯æ¡é«˜åº¦`ï¼ˆå‘ä¸‹å–æ•´ï¼‰
- **åç§»é‡** = `èµ·å§‹ç´¢å¼• Ã— æ¯æ¡é«˜åº¦`

### 3. æ€§èƒ½ä¼˜åŒ–ç‚¹

1. **`useMemo`**ï¼šç¼“å­˜åˆ‡ç‰‡ç»“æœï¼Œé¿å…é‡å¤è®¡ç®—
2. **`transform`**ï¼šç”¨ GPU åŠ é€Ÿï¼Œé¿å…é‡æ’
3. **`willChange`**ï¼šæç¤ºæµè§ˆå™¨ä¼˜åŒ–
4. **`overscan`**ï¼šå¤šæ¸²æŸ“å‡ æ¡ï¼Œé¿å…æ»šåŠ¨ç™½å±

### 4. ä¸ºä»€ä¹ˆåªæ¸²æŸ“å°‘é‡ DOMï¼Ÿ

**ä¼ ç»Ÿåˆ—è¡¨**ï¼š
```
10000 æ¡æ•°æ® â†’ 10000 ä¸ª DOM èŠ‚ç‚¹ â†’ å†…å­˜çˆ†ç‚¸ ğŸ’¥
```

**è™šæ‹Ÿåˆ—è¡¨**ï¼š
```
10000 æ¡æ•°æ® â†’ åªæ¸²æŸ“ 16 ä¸ª DOM èŠ‚ç‚¹ â†’ å†…å­˜å›ºå®š âœ…
```

---

## å®é™…è¿è¡Œç¤ºä¾‹

å‡è®¾ï¼š
- `listData` æœ‰ 10000 æ¡
- `itemSize = 50px`
- `height = 500px`
- `overscan = 3`
- ç”¨æˆ·æ»šåŠ¨äº† `scrollTop = 250px`

**è®¡ç®—è¿‡ç¨‹**ï¼š

1. `containerHeight = 10000 * 50 = 500000px`
2. `visibleCount = Math.ceil(500 / 50) = 10`
3. `startIndex = Math.floor(250 / 50) = 5`
4. `endIndex = 5 + 10 = 15`
5. `safeStart = Math.max(0, 5 - 3) = 2`
6. `safeEnd = Math.min(10000, 15 + 3) = 18`
7. `renderedItems = listData.slice(2, 18)` â†’ 16 æ¡æ•°æ®
8. `offset = 2 * 50 = 100px`

**ç»“æœ**ï¼š
- å ä½å…ƒç´ é«˜åº¦ï¼š500000pxï¼ˆè®©æ»šåŠ¨æ¡æ­£ç¡®ï¼‰
- å®é™…æ¸²æŸ“ï¼š`data[2]` åˆ° `data[17]`ï¼ˆ16 æ¡ï¼‰
- æ¸²æŸ“å±‚å‘ä¸‹åç§» 100pxï¼Œè®©è¿™ 16 æ¡å‡ºç°åœ¨æ­£ç¡®ä½ç½®

---

## æ€»ç»“

è™šæ‹Ÿåˆ—è¡¨çš„æ ¸å¿ƒå°±æ˜¯ï¼š

1. **åªæ¸²æŸ“çœ‹å¾—è§çš„**ï¼šè®¡ç®—å¯è§åŒºåŸŸï¼Œåªæ¸²æŸ“é‚£éƒ¨åˆ†æ•°æ®
2. **å ä½æ’‘é«˜åº¦**ï¼šç”¨ç©ºå…ƒç´ æ’‘å‡ºæ€»é«˜åº¦ï¼Œè®©æ»šåŠ¨æ¡æ­£ç¡®
3. **ç»å¯¹å®šä½ + transform**ï¼šæŠŠå®é™…æ¸²æŸ“çš„æ•°æ®å®šä½åˆ°æ­£ç¡®ä½ç½®

**æ•ˆæœ**ï¼šæ— è®ºæ•°æ®æœ‰å¤šå°‘æ¡ï¼ŒDOM èŠ‚ç‚¹æ•°é‡éƒ½æ˜¯å›ºå®šçš„ï¼ˆæ¯”å¦‚ 16 ä¸ªï¼‰ï¼Œæ€§èƒ½æ°¸è¿œç¨³å®šï¼

---

## æ‰©å±•é˜…è¯»

- [MDN: CSS transform](https://developer.mozilla.org/zh-CN/docs/Web/CSS/transform)
- [MDN: position: absolute](https://developer.mozilla.org/zh-CN/docs/Web/CSS/position)
- [React: useMemo Hook](https://react.dev/reference/react/useMemo)
